<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>

	<class name="edu.emory.library.tast.dm.Submission" table="submissions">
	
	    <id name="id" column="id">
	        <generator class="native"/>
	    </id>
	    
		<property name="time"/>
		<property name="note"/>
		<property name="solved"/>
		<property name="accepted"/>
		
		<set name="sources" inverse="true" cascade="all-delete-orphan">
			<key column="submission_id" />
			<one-to-many class="edu.emory.library.tast.dm.SubmissionSource" />
		</set>
		
		<joined-subclass name="edu.emory.library.tast.dm.SubmissionNew" table="submissions_new">
			<key column="submission_id"/>
			<many-to-one name="editorVoyage" column="editor_edited_voyage_id" class="edu.emory.library.tast.dm.EditedVoyage" />			
			<many-to-one name="newVoyage" column="new_edited_voyage_id" class="edu.emory.library.tast.dm.EditedVoyage" />
		</joined-subclass>
	    
		<joined-subclass name="edu.emory.library.tast.dm.SubmissionEdit" table="submissions_edit">
			<key column="submission_id"/>
			<many-to-one name="editorVoyage" column="editor_edited_voyage_id" class="edu.emory.library.tast.dm.EditedVoyage" />			
			<many-to-one name="newVoyage" column="new_edited_voyage_id" class="edu.emory.library.tast.dm.EditedVoyage" />
			<many-to-one name="oldVoyage" column="old_edited_voyage_id" class="edu.emory.library.tast.dm.EditedVoyage" />
		</joined-subclass>
		
		<joined-subclass name="edu.emory.library.tast.dm.SubmissionMerge" table="submissions_merge">
			<key column="submission_id"/>
			<many-to-one name="editorVoyage" column="editor_edited_voyage_id" class="edu.emory.library.tast.dm.EditedVoyage" />
			<many-to-one name="proposedVoyage" column="proposed_edited_voyage_id" class="edu.emory.library.tast.dm.EditedVoyage" />
			<set name="mergedVoyages" table="submissions_merge_voyages">
				<key column="submission_id" />
				<many-to-many column="edited_voyage_id" unique="true" class="edu.emory.library.tast.dm.EditedVoyage" />
			</set>
		</joined-subclass>

	</class>
	
	<class name="edu.emory.library.tast.dm.EditedVoyage" table="submissions_edited_voyages">
	
		<id name="id" column="id">
	        <generator class="native"/>
	    </id>
	
		<many-to-one name="voyage" column="voyage_iid" class="edu.emory.library.tast.dm.Voyage" />
	
		<map name="attributeNotes" table="submissions_attribute_notes">
			<key column="edited_voyage_id"/>
			<index column="attribute_name" type="string"/>
			<element column="note" type="string"/>
		</map>
	
	</class>
	
	
	<class name="edu.emory.library.tast.dm.SubmissionSource" table="submissions_sources">
	
	    <id name="id" column="id">
	        <generator class="native"/>
	    </id>
	    
		<property name="note"/>
		
	    <many-to-one name="submission" column="submission_id" not-null="true"/>
		
		<joined-subclass name="edu.emory.library.tast.dm.SubmissionSourcePaper" table="submissions_sources_papers">
			<key column="source_id"/>
			<property name="authors" column="authors" />
			<property name="journal" column="journal" />
			<property name="pageFrom" column="page_from" />
			<property name="pageTo" column="page_to" />
			<property name="year" column="year" />
		</joined-subclass>
		
		<joined-subclass name="edu.emory.library.tast.dm.SubmissionSourceBook" table="submissions_sources_books">
			<key column="source_id"/>
			<property name="authors" column="authors" />
			<property name="placeOfPublication" column="place_of_publication" />
			<property name="title" column="title" />
			<property name="publisher" column="publisher" />
			<property name="pageFrom" column="page_from" />
			<property name="pageTo" column="page_to" />
			<property name="year" column="year" />
		</joined-subclass>
		
		<joined-subclass name="edu.emory.library.tast.dm.SubmissionSourceOther" table="submissions_sources_others">
			<key column="source_id"/>
			<property name="title" column="title" />
			<property name="location" column="location" />
			<property name="folioOrPage" column="folio_or_page" />
			<property name="classNumber" column="class_number" />
		</joined-subclass>
	
	</class>

</hibernate-mapping>